import datetime

class MarkdownFormatter:
    @staticmethod
    def generate(data):
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d")
        
        header_info = data.get('header_info', {})
        time_limit = header_info.get('time', 'N/A')
        mem_limit = header_info.get('memory', 'N/A')
        tags_formatted = " ".join([f"`{tag}`" for tag in data.get('tags', [])])

        # --- FIX: Proper HTML Table Formatting ---
        samples_str = ""
        if data.get('samples'):
            samples_str += "### ğŸ§ª Example\n"
            samples_str += "| Input | Output |\n| :--- | :--- |\n"
            for sample in data['samples']:
                # 1. Convert newlines to <br> because Markdown tables don't support \n
                inp = sample['input'].replace("\n", "<br>")
                out = sample['output'].replace("\n", "<br>")
                
                # 2. Use <pre> tag instead of backticks ` ` 
                # Backticks disable <br>, but <pre> allows it while keeping code font.
                samples_str += f"| <pre>{inp}</pre> | <pre>{out}</pre> |\n"
        # ------------------------------------

        note_section = ""
        if data.get('note'):
            note_section = f"### ğŸ“ Note\n{data['note']}"

        template = f"""# {data.get('title', 'Untitled')}

| â³ Time Limit | ğŸ’¾ Memory Limit | ğŸ·ï¸ Tags |
| :---: | :---: | :--- |
| {time_limit} | {mem_limit} | {tags_formatted} |

---

### ğŸ“œ Problem Description
{data.get('statement', '')}

---

### ğŸ“¥ Input
{data.get('input_spec', 'No input specification.')}

### ğŸ“¤ Output
{data.get('output_spec', 'No output specification.')}

---

{samples_str}

{note_section}

---
*Generated by Problem-Auto-Doc ğŸ¤– on {timestamp}*
"""
        return template
